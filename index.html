<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>AECF Kids Count Annual Report</title>
		<link href='http://fonts.googleapis.com/css?family=Fredericka+the+Great' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Maven+Pro:400,500,700,900' rel='stylesheet' type='text/css'>
		<link href="css/aecf.css" rel="stylesheet" type="text/css">
        
        <link href='http://fonts.googleapis.com/css?family=Stardos+Stencil|Libre+Baskerville:400,400italic,700|Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
		<!-- 1. Add these JavaScript inclusions in the head of your page -->
		<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
	
        
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
        <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="http://d3js.org/queue.v1.min.js"></script>
        
        
        
        
        
        
</head>

<body>
	
    <h1>Kids Count Annual Report - Concept</h1>
	<div>
    
    <div id="chart"></div>

    <script> 

    var width = 960,
        height = 600;

    var svg = d3.select("#chart").append("svg")
        .attr("width", width)
        .attr("height", height);
    
    var path = d3.geo.path();

    
    var color = d3.scale.quantize()
       .range(["rgb(230,97,1)","rgb(253,184,99)","rgb(247,247,247)","rgb(178,171,210)","rgb(94,60,153)"]);  
     


    d3.csv("data/ChildrenNotAttendingPreschool.csv", function(data) {
        //console.log(data);
        color.domain([
                d3.min(data, function(d) { return +d.PercentChange0512; }),
                d3.max(data, function(d) { return +d.PercentChange0512; })
        ]);


        d3.json("data/us-states.json", function(json) {
            //console.log(json);

            //Merge the ag. data and GeoJSON
            //Loop through once for each ag. data value
            for (var i = 0; i < data.length; i++) {

                //Grab state name
                var dataState = data[i].name;
                //console.log(dataState);

                //Grab data value, and convert from string to float
                var dataValue = parseFloat(data[i].PercentChange0512);
                //console.log(dataValue);

                //Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    //console.log(json.features)

                    var jsonState = json.features[j].properties.name;
                    //console.log(json.features[j].properties);

                    if (dataState == jsonState) {
                        //console.log("match")

                        //Copy the data value into the JSON
                        json.features[j].properties.value = dataValue;

                        //Stop looking through the JSON
                        break;

                    }

                }
            }

            for (var i = 0; i < data.length; i++) {
            svg.selectAll("path")
               .data(json.features)
               .enter()
               .append("path")
               .attr("d", path)
               .style("fill", function(d) {
                    //Get data value
                    var value = d.properties.value;

                    if (value) {
                        console.log(value)
                            //If value exists…
                            return color(value);
                    } else {
                            //If value is undefined…
                            return "#EEE";
                    }
               });
           }
        })
    })   

        


    </script>
   	</div>
    <div style="height:50px; clear:both">&nbsp;</div>
    

	
    </div>
    
</body>
</html>
